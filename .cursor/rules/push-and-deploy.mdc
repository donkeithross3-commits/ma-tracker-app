---
description: Commit, push, and deploy to production when a task is completed
alwaysApply: true
---

> Shared agent contract: [docs/agent/AGENTS.md](docs/agent/AGENTS.md)

# Push and Deploy on Task Completion

When you **complete a task** that changed code in this repo:

1. **Commit** the relevant files with a clear message.
2. **Push** to `origin main`: `git push origin main`
3. **Deploy** to production (droplet):
   ```bash
   ssh droplet 'cd ~/apps/ma-tracker-app && git pull origin main && cd ~/apps && docker compose build --no-cache web && docker compose up -d --force-recreate web'
   ```
   **Do NOT copy repo `data/krj/` into `~/apps/data/krj/` on deploy.** Production KRJ data is owned by the Saturday cron on the droplet (`run_krj_weekly.sh` — full pipeline). That job writes into `~/apps/data/krj/`. If deploy overwrites that volume with the repo, the dashboard reverts to stale data.

   _(Market caps are updated by the weekly job; if you run `fetch-krj-market-caps` manually on the droplet, it writes to the volume directly.)_

Do this **automatically** at the end of the task—do not wait for the user to ask. The agent has permission to push and deploy.

- If only the Python service changed (no Next.js/agent bundle): use the lighter deploy that restarts uvicorn (see `.cursorrules` Deployment Process).
- Production: https://dr3-dashboard.com — Droplet SSH alias: `droplet`
