> Shared agent contract: [docs/agent/AGENTS.md](docs/agent/AGENTS.md)

# IB TWS API Settings — Required Configuration

When working on the IB Data Agent or any code that connects to IB TWS via the API,
these three TWS settings (under File → Global Configuration → API → Settings) must be
correctly configured.  Reference this when debugging agent connectivity or onboarding users.

## 1. Enable ActiveX and Socket Clients  ✅ Must be CHECKED

The master API switch.  When off (the TWS default), TWS refuses all incoming socket
connections.  Our agent's `EClient.connect()` will fail.  Nothing works without this.

- TWS default: **OFF**
- IB Gateway default: **ON**

## 2. Read-Only API  — Optional (checked = quote-only; unchecked = orders allowed)

When **checked** (the IB default), TWS blocks:
- Order placement: `placeOrder`, `cancelOrder`
- Order information: `reqOpenOrders`, `reqAutoOpenOrders`, `openOrder`/`orderStatus` callbacks

When checked, these **still work** (per IB docs):
- Market data: `reqMktData`, `reqMarketDataType`
- Contract lookups: `reqContractDetails`, `reqSecDefOptParams`
- Positions: `reqPositions`
- Account data: `reqAccountUpdates`

So users can **leave Read-Only checked** for maximum safety when they only need quotes and positions; the agent connects and works for market data. For order placement and order book, they must **uncheck** Read-Only.

**Debugging**: "Agent connected, market data works, but orders fail / order book empty" → Read-Only is still checked.

## 3. Socket Port (TWS default: 7496 = live, 7497 = paper)

| Application | Live | Paper |
|-------------|------|-------|
| TWS         | 7496 | 7497  |
| IB Gateway  | 4001 | 4002  |

The agent tries the configured port first, then the other (7496/7497), so it connects to whichever TWS is running without requiring a config change. Default in config is 7497 (paper). For IB Gateway, set `IB_PORT` to 4001 or 4002 in `config.env`.

## Optional but Recommended

- **Trusted IP Addresses**: Add `127.0.0.1` to avoid the TWS confirmation popup on each connect.
- **Master Client ID**: Leave unset (our agent uses clientId=0 for `reqAutoOpenOrders` compatibility).
