# ma-tracker-app rules

## Multi-Device Sync Workflow
- Before ending a session, ensure all changes are committed and pushed.
- Use `pushall` command to sync both repos before switching machines.
- After making significant changes, commit with descriptive messages and push to GitHub.
- Production domain: https://dr3-dashboard.com
- Droplet: 134.199.204.12 (SSH alias: `droplet`)

## Deployment Process (ALWAYS DO THIS AFTER CHANGES)
After committing and pushing changes, deploy to production:
```bash
ssh droplet 'cd ~/apps/ma-tracker-app && git pull origin main && docker build -f Dockerfile.prod -t ma-tracker-app-dev . && cd ~/apps && docker compose up -d web'
```
For Python service changes only (no Docker rebuild needed):
```bash
ssh droplet 'cd ~/apps/ma-tracker-app && git pull origin main && kill $(lsof -t -i :8000) 2>/dev/null; sleep 2 && cd python-service && source .venv/bin/activate && python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 &'
```

## IB Data Agent Versioning
The IB Data Agent auto-updates from version.txt. When making changes to the agent:
1. Edit files in `python-service/standalone_agent/`
2. **BUMP THE VERSION** in `python-service/standalone_agent/version.txt` (e.g., 1.0.0 â†’ 1.0.1)
3. Deploy as normal - users' agents will auto-download the update on next startup

Version format: MAJOR.MINOR.PATCH
- PATCH: Bug fixes, minor improvements
- MINOR: New features, non-breaking changes  
- MAJOR: Breaking changes

Files included in agent download (see `app/api/ma-options/download-agent/route.ts`):
- ib_data_agent.py, ib_scanner.py, install.py, requirements.txt, README.md
- start_windows.bat, start_windows.ps1, start_unix.sh, config.env.template, version.txt
- python_bundle/ (bundled Python for Windows), ibapi/ (IB API library)

## Framework
- This is a Next.js 16 app using the App Router.
- /app/krj/page.tsx:
  - Reads CSVs from data/krj/*.csv.
  - Should remain read-only (no mutations), just a report viewer for KRJ signals.
  - Do not change the CSV location or naming scheme without explicit instruction.
- middleware.ts:
  - Provides NextAuth v5 authentication. Protected routes redirect to /login.
  - Do not remove or relax this auth without explicit instruction.
- Styling:
  - Use Tailwind utility classes consistent with existing patterns.

## UI Design Principles - HIGH DENSITY TRADER DASHBOARDS
- **Ruthlessly minimize vertical space**: Every pixel counts on trading dashboards.
  - Page padding: `px-3 py-2` (not `p-4` or larger)
  - Margins between sections: `mb-1` to `mb-3` (not `mb-4` or `mb-6`)
  - Tab lists: `mb-3` after tabs, `py-1.5` for tab triggers
  - Filter/control rows: inline layout with `py-1.5 px-3`, not stacked with `p-4`
  - Section spacing: `space-y-3` (not `space-y-6`)
- **Combine related elements on single rows**:
  - Title + subtitle on same row block (subtitle below title, no extra margin)
  - Status indicators + action buttons + user menu all on one header row
  - Filter labels inline with filter controls, not stacked
- **Keep font sizes readable but reduce surrounding whitespace**:
  - Maintain text-2xl for page titles, text-sm for body text
  - Reduce padding/margin around text, not the text size itself
- **Dark, high-contrast theme**: bg-gray-950, text-gray-100, no decorative fluff
- **Right-aligned numeric columns** with limited decimals and compact units
- **Allow header labels to wrap** rather than adding horizontal scroll
- **Place summary elements above/below tables**, not at the side

- /app/krj/page.tsx is a trader-facing report. Follow docs/krj_ui_style.md.
- Do not change CSV loading or data logic without explicit request.
- Styling changes should be implemented via Tailwind classes and small formatting helpers only.
